variables:
  VersionSuffix: -rc.1-alpha.$(Build.BuildNumber)

jobs:
- job: Setup
  steps:
    - powershell: echo "##vso[task.setvariable variable=myOutputVar;isOutput=true]this is the value"
      name: setvarStep
    - script: echo $(setvarStep.myOutputVar)
      name: echovar
    - pwsh: >
          $path = "$(Build.Repository.LocalPath)\version.txt";
          Write-Host "Grabbing version from: $path";

          if(![System.IO.File]::Exists($path)){
            Write-Error "File not found!";
          }

          $version = (Get-Content $path).Trim();
          Write-Host "Version found: $version";

          try
          {
            [System.Management.Automation.SemanticVersion]::Parse($version);
          }
          catch
          {
            Write-Error "'$version' is an invalid SemVer version"
          }

          Write-Host "##vso[task.setvariable variable=BaseVersion;isOutput=true]$version";
      failOnStderr: true
      displayName: "Verify and set BaseVersion variable"
    - script: echo $(setvarStep.BaseVersion)
      name: echovar

- job: Read
  dependsOn: Setup
  variables:
    CoalesceVersion: $[ dependencies.Setup.outputs['job1.setvarStep.BaseVersion'] ]
  steps:
    - pwsh: "Write-Host $(CoalesceVersion)"